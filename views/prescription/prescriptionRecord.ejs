<!DOCTYPE html>
<div class="section-record">
    <div class="record-title">
        <h1>복용약 기록</h1>
        <button onclick="openPopupRecord()">기록 추가</button>
    </div>

    <div class="record-list" id="consumption-list">
        <div class="prescription-list-content">
            <div class="record-object">
                <h1>렉사프로</h1>
                <hr>
                <div>
                    <div style="margin: 0;">
                        <div style="margin: 0 10rem auto auto;">
                            <p><b>복용 일자</b></p>
                            <p>2024-03-05</p>
                        </div>
                        <div style="margin: 0;">
                            <p><b>복용 일자</b></p>
                            <p>2024-03-05</p>
                        </div>
                    </div>
                </div>
                <div>
                    <p><b>현재 복용량</b></p>
                    <p>5 mg</p>
                </div>
            </div>

            <div class="record-object">
                <h1>빨간약</h1>
                <hr>
                <div>
                    <div style="margin: 0;">
                        <div style="margin: 0 10rem auto auto;">
                            <p><b>복용 일자</b></p>
                            <p>2024-03-05</p>
                        </div>
                        <div style="margin: 0;">
                            <p><b>복용 일자</b></p>
                            <p>2024-03-05</p>
                        </div>
                    </div>
                </div>
                <div>
                    <p><b>현재 복용량</b></p>
                    <p>5 mg</p>
                </div>
            </div>
        </div>

        <div id="popupRecord" class="popup-record">
            <div class="record-form" id="record-list">
                <h3>복용 기록 추가</h3>
                <form>
                    <select>
                        <option id="record-select" value="">처방약 선택</option>
                    </select>
                    <input type="date" id="record-date" placeholder="복용 날짜">
                    <input type="time" id="record-time" placeholder="복용 시간">
                    <button type="submit" class="add-button-record">추가</button>
                    <span class="close-btn-record" onclick="closePopupRecord()">닫기</span>
                </form>
            </div>            
        </div>
    </div>

    <!-- <button onclick="removeRecord(this)">-</button> -->
    <!-- <button class="add-button" onclick="addConsumption()">+ 추가</button> -->
</div>

<script>
    function openPopupRecord() {
		var popup = document.getElementById("popupRecord");
		popup.style.visibility = "visible";
		popup.style.opacity = "1";
	}

	function closePopupRecord() {
		var popup = document.getElementById("popupRecord");
		popup.style.visibility = "hidden";
		popup.style.opacity = "0";
	}

    function addConsumption() {
            const list = document.getElementById('consumption-list');
            const newItem = document.createElement('li');
            const select = document.createElement('select');
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = '처방약 선택';
            select.appendChild(defaultOption);
            const consumptionDate = document.createElement('input');
            consumptionDate.type = 'date';
            consumptionDate.placeholder = '복용 날짜';
            const consumptionTime = document.createElement('input');
            consumptionTime.type = 'time';
            consumptionTime.placeholder = '복용 시간';
            const removeButton = document.createElement('button');
            removeButton.textContent = '-';
            removeButton.onclick = function() {
                removeRecord(removeButton);
            };
            newItem.appendChild(select);
            newItem.appendChild(consumptionDate);
            newItem.appendChild(consumptionTime);
            newItem.appendChild(removeButton);
            list.appendChild(newItem);
            updatePrescriptionOptions();
        }

    function updatePrescriptionOptions() {
        const prescriptionList = document.querySelectorAll('#prescription-list li');
        const consumptionSelects = document.querySelectorAll('#consumption-list select');
        const options = Array.from(prescriptionList).map(li => {
            const nameInput = li.querySelector('input[type="text"]');
            return nameInput.value;
        }).filter(value => value !== '');

        consumptionSelects.forEach(select => {
            const currentSelection = select.value;
            select.innerHTML = '';
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = '처방약 선택';
            select.appendChild(defaultOption);

            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                if (option === currentSelection) {
                    optionElement.selected = true;
                }
                select.appendChild(optionElement);
            });
        });
    }


</script>